graph TD
    user((UsuÃ¡rio/Internet))
    
    subgraph Azure["Azure Cloud (Brazil South)"]
        subgraph RG["Resource Group: rg-meurrh-360-pnt-br-apgw-02-hom"]
            
            subgraph Shared["Recursos Compartilhados"]
                ACR["Azure Container Registry"]
                KV["Key Vault"]
                LAW["Log Analytics Workspace"]
                APIM["API Management"]
            end

            subgraph VNet["VNet: meurh360-br-vnet-homolog"]
                
                subgraph SubnetAGW["Subnet: AppGateway"]
                    PIP["Public IP (Basic/Dynamic)"]
                    AGW["Application Gateway (Standard V1)"]
                end

                subgraph SubnetACA["Subnet: Container Apps"]
                    CAE["Container Apps Env"]
                    APP["Container App (API)"]
                end

                subgraph SubnetDB["Subnet: Postgres"]
                    DB[("PostgreSQL Flexible Server")]
                end
            end
        end
    end

    user -->|"HTTP/80"| PIP
    PIP --> AGW
    AGW -->|"Rota Default (HTTP)"| APP
    AGW -.->|"Rota /api (HTTPS)"| APIM
    APIM -->|"Backend API"| APP
    APP -->|"TCP/5432"| DB
    APP -.->|"Pull Image"| ACR
    APP -.->|"Secrets"| KV
    APP -.->|"Logs"| LAW
